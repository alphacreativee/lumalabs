import{preloadImages}from"../../libs/utils.js";let lenis;function initLenis(){lenis=new Lenis({duration:1.2,easing:e=>Math.min(1,1.001-Math.pow(2,-10*e)),smooth:!0}),requestAnimationFrame(function e(t){lenis.raf(t),requestAnimationFrame(e)}),lenis.on("scroll",ScrollTrigger.update),gsap.ticker.add(e=>{lenis.raf(1e3*e)})}function hero(){var e=document.querySelector(".hero"),t=document.querySelector(".hero-personas");let r=document.querySelector(".hero-wrapper__video"),o=document.querySelector(".hero-wrapper__content");document.getElementById("header"),e.offsetHeight;gsap.to(".hero",{scrollTrigger:{trigger:".hero",start:"top top",end:"+=200%",scrub:1,pin:!0,pinSpacing:!1}}),gsap.to(r,{width:"80px",height:"40px",top:"calc(50% + 5px)",left:"50%",yPercent:50,xPercent:-50,borderRadius:"40px",ease:"none",scrollTrigger:{trigger:r,start:"top top",end:"+=85%",scrub:!0,pinSpacing:!1,onUpdate:e=>{e=e.progress;gsap.to(r,{opacity:1==e?0:1,duration:.3}),gsap.to(o,{opacity:.05<e?0:1,duration:.3})}}}),gsap.fromTo(".hero-wrapper__bg",{opacity:0},{opacity:1,ease:"none",scrollTrigger:{trigger:r,start:"top top",end:"+=100%",scrub:!0}}),gsap.to(".hero",{backgroundColor:"rgb(213 213 213)",ease:"none",scrollTrigger:{trigger:r,start:"top top",end:"+=100%",scrub:!0}}),gsap.to(".item-ovl",{width:"calc(100vw - 40px)",height:"calc(100vh - 140px)",duration:.8,delay:1,zIndex:2,top:"20px",yPercent:0,ease:"none",onUpdate:function(){var e,t=this.progress();.01<=t&&(document.querySelector(".hero-switcher .list-item").style.opacity=0),.8<=t&&gsap.to(".hero-switcher .item-ovl",{opacity:0,duration:.5,ease:"none"}),.8<=t&&(document.querySelector("#header").classList.remove("loading"),document.querySelector(".hero-switcher .list-item").style.opacity=1,e=document.querySelector(".hero-wrapper__video video"))&&e.play().catch(e=>console.error("Không thể phát video:",e)),1==t&&(document.querySelector(".hero-switcher").classList.remove("loading"),document.querySelector(".hero").classList.remove("loading"))}}),gsap.to(".item-ovl",{width:"calc(100vw - 40px)",height:"calc(100vh - 140px)",duration:.8,delay:1,zIndex:2,top:"20px",yPercent:0,ease:"none",onUpdate:function(){var e=this.progress();.01<=e&&(document.querySelector(".hero-switcher .list-item").style.opacity=0),.8<=e&&document.querySelector("#header").classList.remove("loading"),1==e&&(document.querySelector(".hero-switcher").classList.remove("loading"),document.querySelector(".hero").classList.remove("loading"),setTimeout(()=>{document.querySelector(".hero-switcher .list-item").style.opacity=1},.3))}}),gsap.registerPlugin(ScrollTrigger),gsap.fromTo("#header",{top:"100%",yPercent:-100,opacity:1},{top:0,yPercent:0,ease:"none",duration:4,scrollTrigger:{trigger:r,start:"top top",end:"bottom top",scrub:!0,pinSpacing:!1,scroller:"body",onUpdate:e=>{var t=e.progress.toFixed(2),r=document.getElementById("header");gsap.to(r,{opacity:t<.1?1:t<=.2?1-10*(t-.1):t<.99?0:1}),r.classList.toggle("header--fixed",.7<=t),document.querySelector(".hero-switcher").classList.toggle("active",1==e.progress),document.querySelector(".hero-gradient").classList.toggle("active",1==e.progress)}}}),gsap.timeline({scrollTrigger:{trigger:".item-ovl",start:"top center",toggleActions:"play none none none",onUpdate:e=>{.8<=e.progress&&(document.querySelector("#header").classList.remove("loading"),document.querySelector(".hero-switcher").classList.remove("loading"))}}}).to(".item-ovl",{width:"calc(100vw - 40px)",height:"calc(100vh - 140px)",duration:.8,delay:1,top:"20px",yPercent:0,ease:"none"}).to(".item-ovl",{opacity:0,duration:.3,ease:"none"},"-=0.24");let a=document.querySelectorAll(".hero-switcher .item");a.forEach(e=>{e.addEventListener("click",function(){var e,t,r;!(e=this).classList.contains("active")&&(a.forEach(e=>e.classList.remove("active")),e.classList.add("active"),t=`--${e=e.getAttribute("data-media-persona")}-color`,(r=document.querySelector(".hero-gradient"))&&(r.style.backgroundColor=`var(${t})`),document.querySelectorAll(".hero-wrapper__bg .bg-item").forEach(e=>e.classList.remove("active")),r=document.querySelector(`.hero-wrapper__bg .bg-item[data-media-persona="${e}"]`))&&r.classList.add("active")})}),gsap.to(t,{scale:.52,ease:"none",scrollTrigger:{trigger:r,start:"top top",end:"+=100%",scrub:!0,pinSpacing:!1,onUpdate:e=>{1==e.progress.toFixed(2)?document.querySelector(".hero").classList.add("done-video"):document.querySelector(".hero").classList.remove("done-video")}}}),ScrollTrigger.refresh();let n={listeners:{},on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},emit(e){this.listeners[e]&&this.listeners[e].forEach(e=>e())}},i=[];let s=document.querySelector(".hero-personas canvas"),l=(s.width=800,s.height=800,s.getContext("2d")),c=-1,d=1;function p(){var e,t,r=Math.round((r=d,e=1,t=5,Math.max(0,Math.min(1,(r-e)/(t-e)))*(i.length-1)));r!==c&&l&&(c=r,l.clearRect(0,0,s.width,s.height),(t=i[r])instanceof HTMLImageElement?l.drawImage(t,0,0,s.width,s.height):console.error("Loaded image is not an HTMLImageElement",t)),requestAnimationFrame(p)}n.on("sequence-loaded",function(){document.body.classList.remove("loading"),requestAnimationFrame(p)}),e=[Array.from({length:24},(e,t)=>`./assets/morphing/1-2/1-2${String(t).padStart(2,"0")}.png`),Array.from({length:24},(e,t)=>`./assets/morphing/2-3/2-3${String(t).padStart(2,"0")}.png`),Array.from({length:24},(e,t)=>`./assets/morphing/3-4/3-4${String(t).padStart(2,"0")}.png`),Array.from({length:24},(e,t)=>`./assets/morphing/4-5/4-5${String(t).padStart(2,"0")}.png`),Array.from({length:24},(e,t)=>`./assets/morphing/5-1/5-1${String(t).padStart(2,"0")}.png`)].flat().map(r=>new Promise(e=>{let t=new Image;t.src=r,t.onload=()=>e(t),t.onerror=()=>e(null)})),Promise.all(e).then(e=>{i=e,n.emit("sequence-loaded")});let g=null,u=null,m=1,h=1;function y(e){var t,e=e-(u=u||e);e<1e3?(e=e/1e3,t=h-m,d=m+t*e,g=requestAnimationFrame(y)):(d=h,g=null,u=null)}var v=document.querySelectorAll(".hero-switcher .item");for(let e=0;e<v.length;e++)v[e].addEventListener("click",function(e){var t=parseInt(this.getAttribute("data-state"));t=t,g&&cancelAnimationFrame(g),u=null,m=d,h=t,g=requestAnimationFrame(y)})}Splitting(),gsap.registerPlugin(Draggable),gsap.defaults({ease:"none"});var picker=document.querySelector(".picker"),cells=document.querySelectorAll(".cell"),proxy=document.createElement("div"),cellWidth=window.innerWidth/2.3,numCells=cells.length,cellStep=1/numCells,wrapWidth=cellWidth*numCells,baseTl=gsap.timeline({paused:!0}),wrapProgress=gsap.utils.wrap(0,1);gsap.set(picker,{width:wrapWidth-cellWidth});for(var i=0;i<cells.length;i++)initCell(cells[i],i);var animation=gsap.timeline({repeat:-1,paused:!0}).add(baseTl.tweenFromTo(1,2,{immediateRender:!0})),draggable=new Draggable(proxy,{type:"x",trigger:picker,onDrag:updateProgress,onThrowUpdate:updateProgress,snap:{x:snapX},onRelease:function(){console.log("onRelease")}});function snapX(e){return Math.round(e/cellWidth)*cellWidth}function updateProgress(){animation.progress(wrapProgress(this.x/wrapWidth))}function initCell(e,t){gsap.set(e,{width:cellWidth,scale:.6,x:-cellWidth,y:150});e=gsap.timeline({repeat:1}).to(e,1,{x:"+="+wrapWidth},0).to(e,cellStep,{color:"#009688",scale:1,repeat:1,y:0,yoyo:!0},.5-cellStep);baseTl.add(e,i*-cellStep)}function parallaxIt(e,t,r){var o=t.getBoundingClientRect(),a=e.clientX-o.left;gsap.to(t,{duration:.3,x:(a/o.width-.5)*r,y:((e.clientY-o.top)/o.height-.5)*r,ease:"power2.out"})}function callParallax(e){var t=e.currentTarget,r=t.querySelector("img"),o=t.querySelector("span");parallaxIt(e,t,10),r&&parallaxIt(e,r,20),o&&parallaxIt(e,o,15)}function hoverIcon(){var e=document.querySelectorAll(".hero-switcher .list-item .item"),t=document.querySelectorAll(".btn-large");e.forEach(t=>{t.addEventListener("mousemove",e=>{callParallax(e)}),t.addEventListener("mouseleave",()=>{gsap.to(t,{duration:.3,height:60,width:100,x:0,y:0,ease:"power2.out"});var e=t.querySelector("img");e&&gsap.to(e,{duration:.3,x:0,y:0,scale:1,ease:"power2.out"})}),t.addEventListener("mouseenter",()=>{var e=t.querySelector("img");e&&gsap.to(e,{duration:.3,scale:.9,ease:"power2.out"})})}),t.forEach(t=>{t.addEventListener("mousemove",e=>{callParallax(e)}),t.addEventListener("mouseleave",()=>{gsap.to(t,{duration:.3,x:0,y:0,ease:"power2.out"});var e=t.querySelector("span");e&&gsap.to(e,{duration:.3,x:0,y:0,scale:1,ease:"power2.out"})}),t.addEventListener("mouseenter",()=>{var e=t.querySelector("span");e&&gsap.to(e,{duration:.3,scale:.9,ease:"power2.out"})})})}function testimonial(){let n=document.querySelector(".testimonial__scroll-wrapper"),i=document.querySelector(".testimonial__container"),s=document.querySelector(".custom-cursor"),l=s.querySelector("span"),c=0,d=!1;i.addEventListener("mouseenter",()=>{d=!0,s.style.opacity="1"}),i.addEventListener("mouseleave",()=>{d=!1,n.style.transform="translateX(0px)",s.style.opacity="0"}),i.addEventListener("mousemove",e=>{var t,r,o,a;o=e,d&&(r=i.offsetWidth,a=n.scrollWidth-r,t=i.getBoundingClientRect(),o=o.clientX-t.left,c=r-200<=o?-a:Math.min(0,o/(r-200)*a*-1),c=Math.max(-a,Math.min(0,c)),n.style.transform=`translateX(${c}px)`),t=e,r=(o=s.getBoundingClientRect()).width,o=o.height,a=t.clientX,t=t.clientY,s.style.transform=`translate(${a-r/2}px, ${t-o/2}px)`,r=i.getBoundingClientRect(),o=a-r.left,a=t-r.top,t=.025*(o-i.offsetWidth/2),r=.05*(a-i.offsetHeight/2),l.style.transform=`translate(${t}px, ${r}px)`})}function animationText(){var e=document.querySelectorAll("[data-splitting]");document.querySelector(".btn-large");e.forEach(e=>{gsap.fromTo(e.querySelectorAll(".char"),{"will-change":"opacity",opacity:0,transform:"translateX(0.5ex)"},{ease:"none",transform:"translateX(0)",opacity:1,stagger:.05,scrollTrigger:{trigger:e,start:"top 70%",end:"top 70%"}})})}function introduce(){function a(e,t,r,o,a){return(e-t)*(a-o)/(r-t)+o}gsap.registerPlugin(ScrollTrigger),gsap.utils.toArray(".slide").forEach((r,e)=>{t=r;let o=(t=window.getComputedStyle(t).transform.match(/matrix3d\((.+)\)/))?(t=t[1].split(", "),parseFloat(t[14]||0)):0;var t;ScrollTrigger.create({trigger:".slider",start:"top 20%",end:"bottom 90%",scrub:5,pinSpacing:!0,onUpdate:e=>{e=5e3*e.progress,e=o+e;let t;console.log(o),t=-2500<e?a(e,-2500,0,.5,1):a(e,-5e3,-2500,0,.5),r.style.opacity=t,r.style.transform=`translate3d(-50%,-50%,${e}px)`}})})}let init=()=>{initLenis(),hero(),hoverIcon(),testimonial(),animationText(),introduce(),window.addEventListener("resize",()=>{ScrollTrigger.refresh()})};preloadImages("img").then(()=>{document.body.classList.remove("loading"),init()}),$(window).on("beforeunload",function(){$(window).scrollTop(0)});