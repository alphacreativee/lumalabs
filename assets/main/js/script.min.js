import { preloadImages } from "../../libs/utils.js";
let lenis;
function initLenis() {
  (lenis = new Lenis({
    duration: 1.2,
    easing: (e) => Math.min(1, 1.001 - Math.pow(2, -10 * e)),
    smooth: !0
  })),
    requestAnimationFrame(function e(t) {
      lenis.raf(t), requestAnimationFrame(e);
    }),
    lenis.on("scroll", ScrollTrigger.update),
    gsap.ticker.add((e) => {
      lenis.raf(1e3 * e);
    });
}
function hero() {
  var e = document.querySelector(".hero"),
    t = document.querySelector(".hero-personas");
  let o = document.querySelector(".hero-wrapper__video"),
    r = document.querySelector(".hero-wrapper__content");
  document.getElementById("header"), e.offsetHeight;
  gsap.to(".hero", {
    scrollTrigger: {
      trigger: ".hero",
      start: "top top",
      end: "+=200%",
      scrub: 1,
      pin: !0,
      pinSpacing: !1,
      markers: !0
    }
  }),
    gsap.to(o, {
      width: "80px",
      height: "40px",
      top: "calc(50% + 5px)",
      left: "50%",
      yPercent: 50,
      xPercent: -50,
      borderRadius: "40px",
      ease: "none",
      scrollTrigger: {
        trigger: o,
        start: "top top",
        end: "+=100%",
        scrub: !0,
        pinSpacing: !1,
        markers: !0,
        onUpdate: (e) => {
          e = e.progress.toFixed(2);
          gsap.to(o, { opacity: 1 == e ? 0 : 1, duration: 0.3 }),
            gsap.to(r, { opacity: 0.05 < e ? 0 : 1, duration: 0.3 });
        }
      }
    }),
    gsap.fromTo(
      ".hero-wrapper__bg .bg-item.active",
      { opacity: 0 },
      {
        opacity: 1,
        ease: "none",
        scrollTrigger: {
          trigger: o,
          start: "top top",
          end: "+=100%",
          scrub: !0
        }
      }
    ),
    gsap.to(".hero", {
      backgroundColor: "#B9BABA",
      ease: "none",
      scrollTrigger: { trigger: o, start: "top top", end: "+=100%", scrub: !0 }
    }),
    gsap.to(".item-ovl", {
      width: "calc(100vw - 40px)",
      height: "calc(100vh - 140px)",
      duration: 0.8,
      delay: 1,
      zIndex: 2,
      top: "20px",
      yPercent: 0,
      ease: "none",
      onUpdate: function () {
        var e = this.progress();
        0.01 <= e &&
          (document.querySelector(
            ".hero-switcher .list-item"
          ).style.opacity = 0),
          0.8 <= e &&
            gsap.to(".hero-switcher .item-ovl", {
              opacity: 0,
              duration: 0.5,
              ease: "none"
            }),
          0.8 <= e &&
            (document.querySelector("#header").classList.remove("loading"),
            (document.querySelector(
              ".hero-switcher .list-item"
            ).style.opacity = 1)),
          1 == e &&
            (document
              .querySelector(".hero-switcher")
              .classList.remove("loading"),
            document.querySelector(".hero").classList.remove("loading"));
      }
    }),
    gsap.to(".item-ovl", {
      width: "calc(100vw - 40px)",
      height: "calc(100vh - 140px)",
      duration: 0.8,
      delay: 1,
      zIndex: 2,
      top: "20px",
      yPercent: 0,
      ease: "none",
      onUpdate: function () {
        var e = this.progress();
        console.log(e),
          0.01 <= e &&
            (document.querySelector(
              ".hero-switcher .list-item"
            ).style.opacity = 0),
          0.8 <= e &&
            document.querySelector("#header").classList.remove("loading"),
          1 == e &&
            (document
              .querySelector(".hero-switcher")
              .classList.remove("loading"),
            document.querySelector(".hero").classList.remove("loading"),
            setTimeout(() => {
              document.querySelector(
                ".hero-switcher .list-item"
              ).style.opacity = 1;
            }, 0.3));
      }
    }),
    gsap.registerPlugin(ScrollTrigger),
    gsap.fromTo(
      "#header",
      { top: "100%", yPercent: -100, opacity: 1 },
      {
        top: 0,
        yPercent: 0,
        ease: "none",
        duration: 4,
        scrollTrigger: {
          trigger: "#header",
          start: "top top",
          end: "bottom top",
          scrub: !0,
          pinSpacing: !1,
          scroller: "body",
          onUpdate: (e) => {
            var e = e.progress.toFixed(2),
              t = document.getElementById("header");
            gsap.to(t, {
              opacity:
                e < 0.1 ? 1 : e <= 0.2 ? 1 - 10 * (e - 0.1) : e < 0.99 ? 0 : 1
            }),
              t.classList.toggle("header--fixed", 0.9 <= e),
              document
                .querySelector(".hero-switcher")
                .classList.toggle("active", 1 == e),
              document
                .querySelector(".hero-gradient")
                .classList.toggle("active", 1 == e);
          }
        }
      }
    ),
    gsap
      .timeline({
        scrollTrigger: {
          trigger: ".item-ovl",
          start: "top center",
          toggleActions: "play none none none",
          onUpdate: (e) => {
            0.8 <= e.progress &&
              (document.querySelector("#header").classList.remove("loading"),
              document
                .querySelector(".hero-switcher")
                .classList.remove("loading"));
          }
        }
      })
      .to(".item-ovl", {
        width: "calc(100vw - 40px)",
        height: "calc(100vh - 140px)",
        duration: 0.8,
        delay: 1,
        top: "20px",
        yPercent: 0,
        ease: "none"
      })
      .to(".item-ovl", { opacity: 0, duration: 0.3, ease: "none" }, "-=0.24");
  let a = document.querySelectorAll(".hero-switcher .item");
  a.forEach((e) => {
    e.addEventListener("click", function () {
      this.classList.contains("active") ||
        (a.forEach((e) => e.classList.remove("active")),
        this.classList.add("active"));
    });
  }),
    gsap.to(t, {
      scale: 0.52,
      ease: "none",
      scrollTrigger: {
        trigger: o,
        start: "top top",
        end: "+=100%",
        scrub: !0,
        pinSpacing: !1,
        onUpdate: (e) => {
          1 == e.progress.toFixed(2)
            ? document.querySelector(".hero").classList.add("done-video")
            : document.querySelector(".hero").classList.remove("done-video");
        }
      }
    }),
    ScrollTrigger.refresh();
}
function parallaxIt(e, t, o) {
  var r = t.getBoundingClientRect(),
    a = e.clientX - r.left;
  gsap.to(t, {
    duration: 0.3,
    x: (a / r.width - 0.5) * o,
    y: ((e.clientY - r.top) / r.height - 0.5) * o,
    ease: "power2.out"
  });
}
function callParallax(e) {
  var t = e.currentTarget,
    o = t.querySelector("img"),
    r = t.querySelector("span");
  parallaxIt(e, t, 10), o && parallaxIt(e, o, 20), r && parallaxIt(e, r, 15);
}
function hoverIcon() {
  var e = document.querySelectorAll(".hero-switcher .list-item .item"),
    t = document.querySelectorAll(".btn-large");
  e.forEach((t) => {
    t.addEventListener("mousemove", (e) => {
      callParallax(e);
    }),
      t.addEventListener("mouseleave", () => {
        gsap.to(t, {
          duration: 0.3,
          height: 60,
          width: 100,
          x: 0,
          y: 0,
          ease: "power2.out"
        });
        var e = t.querySelector("img");
        e &&
          gsap.to(e, {
            duration: 0.3,
            x: 0,
            y: 0,
            scale: 1,
            ease: "power2.out"
          });
      }),
      t.addEventListener("mouseenter", () => {
        var e = t.querySelector("img");
        e && gsap.to(e, { duration: 0.3, scale: 0.9, ease: "power2.out" });
      });
  }),
    t.forEach((t) => {
      t.addEventListener("mousemove", (e) => {
        callParallax(e);
      }),
        t.addEventListener("mouseleave", () => {
          gsap.to(t, { duration: 0.3, x: 0, y: 0, ease: "power2.out" });
          var e = t.querySelector("span");
          e &&
            gsap.to(e, {
              duration: 0.3,
              x: 0,
              y: 0,
              scale: 1,
              ease: "power2.out"
            });
        }),
        t.addEventListener("mouseenter", () => {
          var e = t.querySelector("span");
          e && gsap.to(e, { duration: 0.3, scale: 0.9, ease: "power2.out" });
        });
    });
}
function testimonial() {
  let n = document.querySelector(".testimonial__scroll-wrapper"),
    i = document.querySelector(".testimonial__container"),
    s = document.querySelector(".custom-cursor"),
    l = s.querySelector("span"),
    c = 0,
    d = !1;
  i.addEventListener("mouseenter", () => {
    (d = !0), (s.style.opacity = "1");
  }),
    i.addEventListener("mouseleave", () => {
      (d = !1),
        (n.style.transform = "translateX(0px)"),
        (s.style.opacity = "0");
    }),
    i.addEventListener("mousemove", (e) => {
      var t, o, r, a;
      (o = e),
        d &&
          ((r = i.offsetWidth),
          (a = n.scrollWidth - r),
          (t = i.getBoundingClientRect()),
          (o = o.clientX - t.left),
          (c = r - 200 <= o ? -a : Math.min(0, (o / (r - 200)) * a * -1)),
          (c = Math.max(-a, Math.min(0, c))),
          (n.style.transform = `translateX(${c}px)`)),
        (t = e),
        (o = s.offsetWidth),
        (r = s.offsetHeight),
        (a = t.clientX),
        (t = t.clientY),
        (s.style.transform = `translate(${a - o / 2}px, ${t - r / 2}px)`),
        (o = i.getBoundingClientRect()),
        (r = a - o.left),
        (a = t - o.top),
        (t = 0.025 * (r - i.offsetWidth / 2)),
        (o = 0.05 * (a - i.offsetHeight / 2)),
        (l.style.transform = `translate(${t}px, ${o}px)`);
    });
}
function animationText() {
  var e = document.querySelectorAll("[data-splitting]");
  document.querySelector(".btn-large");
  e.forEach((e) => {
    gsap.fromTo(
      e.querySelectorAll(".char"),
      { "will-change": "opacity", opacity: 0, transform: "translateX(0.5ex)" },
      {
        ease: "none",
        transform: "translateX(0)",
        opacity: 1,
        stagger: 0.05,
        scrollTrigger: { trigger: e, start: "top 70%", end: "top 70%" }
      }
    );
  });
}
Splitting();
let init = () => {
  initLenis(),
    hero(),
    hoverIcon(),
    testimonial(),
    animationText(),
    window.addEventListener("resize", () => {
      ScrollTrigger.refresh();
    });
};
preloadImages("img").then(() => {
  document.body.classList.remove("loading"), init();
}),
  $(window).on("beforeunload", function () {
    $(window).scrollTop(0);
  });
